Ext.CTCT={init:function(a,b){if(a!=undefined){Ext.CTCT.apiServer=a}else{Ext.CTCT.apiServer="https://api.constantcontact.com"}Ext.CTCT.apiKey=b;Ext.CTCT.auth=localStorage.getItem("CTCT.auth");Ext.CTCT.username=localStorage.getItem("CTCT.username");if(Ext.CTCT.auth!=undefined){return Ext.CTCT.username}else{return false}},login:function(d,b,c){function a(f,h){var e=f+":"+h;var g=Ext.CTCT.Base64.encode(e);return"Basic "+g}Ext.CTCT.auth=a(Ext.CTCT.apiKey+"%"+d,b);Ext.CTCT.username=d;localStorage.setItem("CTCT.auth",Ext.CTCT.auth);localStorage.setItem("CTCT.username",Ext.CTCT.username);if(c!=undefined){c()}},logout:function(){localStorage.removeItem("CTCT.auth");localStorage.removeItem("CTCT.username");Ext.CTCT.auth=undefined;Ext.CTCT.username=undefined},Events:{list:function(e,c){if(c!=undefined){var d=Ext.CTCT.apiServer+"/ws/customers/"+Ext.CTCT.username+"/events?pageNumber="+c}else{var d=Ext.CTCT.apiServer+"/ws/customers/"+Ext.CTCT.username+"/events"}var b=Ext.Ajax.request({callbackFn:e,url:d,method:"GET",headers:{Authorization:Ext.CTCT.auth},success:function(i){var h=Ext.DomQuery.selectNode("link[rel=next]",i.responseXML);var j=new Ext.data.Store({autoLoad:true,fields:["id"],data:i,proxy:{type:"memory",reader:{type:"xml",record:"entry"}}});var n=new Ext.data.Store({autoLoad:true,fields:["Name","Description","Title","Registered","CreatedDate","Status","EventType","RegistrationURL","StartDate","EndDate","PublishDate","AttendedCount","CancelledCount"],data:i,proxy:{type:"memory",reader:{type:"xml",record:"Event"}}});var q=new Ext.data.Store({autoLoad:true,fields:["Location","Address1","Address2","Address3","City","State","Country","PostalCode"],data:i,proxy:{type:"memory",reader:{type:"xml",record:"EventLocation"}}});var l=[];var g=j.getCount();for(var p=0;p<g;p++){var f={};var k=n.getAt(p).data;var m=q.getAt(p).data;f.id=j.getAt(p).data.id.match(/[^/]+$/).toString();f.name=k.Name;f.description=k.Description;f.title=k.Title;f.registered=k.Registered;f.createdDate=new Date().setISO8601(k.CreatedDate).getTime();f.status=k.Status;f.eventType=k.EventType;f.eventLocation={location:m.Location,address1:m.Address1,address2:m.Address2,address3:m.Address3,city:m.City,state:m.State,country:m.Country,postalCode:m.PostalCode};f.registrationUrl=k.RegistrationURL;f.startDate=new Date().setISO8601(k.StartDate).getTime();f.endDate=new Date().setISO8601(k.EndDate).getTime();f.publishDate=new Date().setISO8601(k.PublishDate).getTime();f.attendedCount=k.AttendedCount;f.cancelledCount=k.CancelledCount;l.push(f)}var o=function(s){var r={success:true,httpStatusCode:200,events:l};if(h!=null){r.morePages=true}else{r.morePages=false}s(r)};j.destroy();n.destroy();q.destroy();o(e)},failure:function(f){var g={success:false,httpStatusCode:f.status,events:[],morePages:false};f.request.options.callbackFn(g)}});var a=function(g){if(Ext.Ajax.isLoading(b)==true){var f={success:false,httpStatusCode:401,events:[],morePages:false};g(f);Ext.Ajax.abort(b)}};setTimeout(function(){a(e)},15000)},registrants:function(a,f,d){if(d!=undefined){var e=Ext.CTCT.apiServer+"/ws/customers/"+Ext.CTCT.username+"/events/"+a+"/registrants/?pageNumber="+d}else{var e=Ext.CTCT.apiServer+"/ws/customers/"+Ext.CTCT.username+"/events/"+a+"/registrants"}var c=Ext.Ajax.request({callbackFn:f,url:e,method:"GET",headers:{Authorization:Ext.CTCT.auth},success:function(k){var h=Ext.DomQuery.selectNode("link[rel=next]",k.responseXML);var l=new Ext.data.Store({autoLoad:true,fields:["id"],data:k,proxy:{type:"memory",reader:{type:"xml",record:"entry"}}});var n=new Ext.data.Store({autoLoad:true,fields:["LastName","FirstName","EmailAddress","RegistrationStatus","RegistrationDate","GuestCount","PaymentStatus"],data:k,proxy:{type:"memory",reader:{type:"xml",record:"Registrant"}}});var m=[];var g=l.getCount();for(var p=0;p<g;p++){var j={};var i=n.getAt(p).data;j.id=l.getAt(p).data.id.match(/[^/]+$/).toString();j.lastName=i.LastName;j.firstName=i.FirstName;j.emailAddress=i.EmailAddress;j.registrationStatus=i.RegistrationStatus;j.registrationDate=new Date().setISO8601(i.RegistrationDate).getTime();j.guestCount=i.GuestCount;j.paymentStatus=i.PaymentStatus;j.eventId=a;m.push(j)}var o=function(r){var q={success:true,httpStatusCode:200,registrants:m};if(h!=null){q.morePages=true}else{q.morePages=false}r(q)};l.destroy();n.destroy();o(f)},failure:function(h){var g={success:false,httpStatusCode:h.status,registrants:[],morePages:false};h.request.options.callbackFn(g)}});var b=function(h){if(Ext.Ajax.isLoading(c)==true){var g={success:false,httpStatusCode:401,registrants:[],morePages:false};h(g);Ext.Ajax.abort(c)}};setTimeout(function(){b(f)},15000)},setAttendanceStatus:function(c,h,b,g){var f=Ext.CTCT.apiServer+"/ws/customers/"+Ext.CTCT.username+"/events/"+c+"/registrants/"+h+"/attendancestatus";var a='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n                <atom:entry xmlns:atom="http://www.w3.org/2005/Atom">\n                    <atom:content>\n                        <AttendanceStatus>\n                            <Status>'+b+"</Status>\n                            <Type>GROUP</Type>\n                        </AttendanceStatus>\n                    </atom:content>\n                </atom:entry>";var e=Ext.Ajax.request({callbackFn:g,defaultHeaders:false,url:f,xmlData:a,method:"PUT",headers:{"Content-Type":"application/atom+xml;type=entry",Authorization:Ext.CTCT.auth},success:function(i){var j=function(l){var k={success:true,httpStatusCode:200};l(k)};j(g)},failure:function(j){var i={success:false,httpStatusCode:j.status};j.request.options.callbackFn(i)}});var d=function(j){if(Ext.Ajax.isLoading(e)==true){var i={success:false,httpStatusCode:401};j(i);Ext.Ajax.abort(e)}};setTimeout(function(){d(g)},15000)}}};Ext.CTCT.Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(c){var a="";var k,h,f,j,g,e,d;var b=0;c=Ext.CTCT.Base64._utf8_encode(c);while(b<c.length){k=c.charCodeAt(b++);h=c.charCodeAt(b++);f=c.charCodeAt(b++);j=k>>2;g=((k&3)<<4)|(h>>4);e=((h&15)<<2)|(f>>6);d=f&63;if(isNaN(h)){e=d=64}else{if(isNaN(f)){d=64}}a=a+this._keyStr.charAt(j)+this._keyStr.charAt(g)+this._keyStr.charAt(e)+this._keyStr.charAt(d)}return a},_utf8_encode:function(b){b=b.replace(/\r\n/g,"\n");var a="";for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128){a+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128)}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128)}}}return a}};Date.prototype.setISO8601=function(e){var a=/(\d\d\d\d)(-)?(\d\d)(-)?(\d\d)(T)?(\d\d)(:)?(\d\d)(:)?(\d\d)(\.\d+)?(Z|([+-])(\d\d)(:)?(\d\d))/;if(e.toString().match(new RegExp(a))){var c=e.match(new RegExp(a));var b=0;this.setUTCDate(1);this.setUTCFullYear(parseInt(c[1],10));this.setUTCMonth(parseInt(c[3],10)-1);this.setUTCDate(parseInt(c[5],10));this.setUTCHours(parseInt(c[7],10));this.setUTCMinutes(parseInt(c[9],10));this.setUTCSeconds(parseInt(c[11],10));if(c[12]){this.setUTCMilliseconds(parseFloat(c[12])*1000)}else{this.setUTCMilliseconds(0)}if(c[13]!="Z"){b=(c[15]*60)+parseInt(c[17],10);b*=((c[14]=="-")?-1:1);this.setTime(this.getTime()-b*60*1000)}}else{this.setTime(Date.parse(e))}return this};